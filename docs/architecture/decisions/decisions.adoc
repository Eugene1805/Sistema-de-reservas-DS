== Decisiones Arquitectónicas

=== Introducción

El presente capítulo documenta las *Decisiones Arquitectónicas* tomadas durante el diseño del
Sistema de Gestión Hotelera. Cada decisión representa un elemento clave de la arquitectura,
elegido para satisfacer requisitos críticos del sistema (ASRs), incluyendo atributos de calidad,
restricciones técnicas, preocupaciones arquitectónicas y casos de uso fundamentales.

El objetivo de este registro es proporcionar una referencia clara, trazable y justificable del porqué
de cada selección técnica o estructural. Cada decisión está acompañada de su respectiva
justificación (*Rationale*) y su estado final dentro del diseño.

Todas las decisiones aquí registradas se encuentran en estado *Accepted*, ya que forman parte
de la arquitectura definitiva contenida en este documento. Cada decisión se marca con un identificador único que permite
referencias cruzadas desde la Matriz de Trazabilidad.

=== Registro de decisiones arquitectónicas

[.table]
[cols="1,2,2,2"]
|===
| ID | Decision | Rationale | Status

[[dec-1]]
| 1 
| Usar base de datos MySQL (RDBMS)
| Requisito técnico del sistema (CON-04). Garantiza consistencia ACID, soporte transaccional y fiabilidad operacional.
| Accepted

[[dec-2]]
| 2
| Usar arquitectura en capas
| Mantiene separación de responsabilidades, facilita mantenibilidad, escalabilidad y portabilidad (QAS-08).
| Accepted

[[dec-3]]
| 3
| Exponer APIs RESTful para interacción con clientes web/móvil
| Permite integración multiplataforma (CON-03) y desacoplamiento entre presentación y negocio.
| Accepted

[[dec-4]]
| 4
| Implementar un API Gateway como punto único de entrada
| Centraliza autenticación, autorización y terminación TLS (QAS-05).
| Accepted

[[dec-5]]
| 5
| Cifrado en tránsito mediante HTTPS/TLS
| Protege PII y datos sensibles del cliente (CRN-01).
| Accepted

[[dec-6]]
| 6
| Utilizar el patrón Saga para transacciones distribuidas
| Garantiza atomicidad entre reserva–pago–inventario (QAS-09).
| Accepted

[[dec-7]]
| 7
| Aplicar Idempotency-Key en el servicio de pagos
| Evita pagos dobles en reintentos o fallas del cliente (CRN-02).
| Accepted

[[dec-8]]
| 8
| Incorporar un Message Broker para comunicación asíncrona
| Reduce latencia y soporta picos de tráfico (QAS-02, QAS-04).
| Accepted

[[dec-9]]
| 9
| Utilizar workers asíncronos
| Evita bloquear el flujo principal de reserva (QAS-02).
| Accepted

[[dec-10]]
| 10
| Implementar exclusión mutua en inventario
| Evita dobles reservas bajo alta concurrencia (CRN-05).
| Accepted

[[dec-11]]
| 11
| Redundancia mediante clustering
| Soporta disponibilidad ante fallos (QAS-06).
| Accepted

[[dec-12]]
| 12
| Balanceador de carga
| Distribuye tráfico, mejora escalabilidad (QAS-04).
| Accepted

[[dec-13]]
| 13
| Separar servicios (Reservas, Inventario y Pagos)
| Permite escalamiento independiente.
| Accepted

[[dec-14]]
| 14
| Patrón Repositorio en acceso a datos
| Aísla la lógica de negocio y facilita mantenimiento.
| Accepted

[[dec-15]]
| 15
| Añadir observabilidad (logs, métricas, trazas)
| Facilita auditoría y diagnóstico (CRN).
| Accepted

[[dec-16]]
| 16
| Servicios stateless
| Facilita escalamiento horizontal (QAS-06).
| Accepted

[[dec-17]]
| 17
| Optimizar consultas de disponibilidad (flujos sin bloqueo)
| Cumple latencia P95 para 300 QPS (QAS-02).
| Accepted

|===

== Trazabilidad Arquitectónica

=== Introducción a la Trazabilidad Arquitectónica

La Matriz de Trazabilidad es un artefacto fundamental que permite demostrar la coherencia,
alineación y completitud del diseño arquitectónico del Sistema de Gestión Hotelera. Su propósito
es establecer una relación directa entre los *Drivers Arquitectónicamente Significativos* (ASRs),
que incluyen Atributos de Calidad (QAS), Restricciones (CON), Preocupaciones Arquitectónicas (CRN)
y Casos de Uso (CU), con las decisiones arquitectónicas que los satisfacen.

Este mecanismo de trazabilidad asegura que cada decisión tomada en el diseño esté justificada
por un requisito crítico, evitando decisiones huérfanas o carentes de motivación técnica. Asimismo,
permite verificar que cada ASR haya sido cubierto adecuadamente mediante patrones,
tácticas o estructuras arquitectónicas concretas.

La matriz también sirve como evidencia documentada para métodos formales de evaluación
arquitectónica como ATAM, facilitando la identificación de riesgos y la validación del diseño
contra los objetivos del negocio.

=== Proceso de Trazabilidad

El proceso utilizado para construir esta matriz consta de tres pasos principales:

. *Identificación de Drivers Arquitectónicamente Significativos (ASRs).*  
  Se extrajeron atributos de calidad, restricciones del sistema, preocupaciones
  arquitectónicas y casos de uso críticos relacionados con desempeño, seguridad,
  disponibilidad, escalabilidad, fiabilidad y políticas de negocio.

. *Vinculación con decisiones arquitectónicas.*  
  Cada ASR fue asociado a una o más decisiones tomadas en el Capítulo de Registro de
  Decisiones Arquitectónicas. Las decisiones incluyen tácticas de calidad, patrones y
  estructuras como Saga, API Gateway, Balanceo de Carga, Repositorio, etc.

. *Asignación de artefactos y vistas afectadas.*  
  Se identificaron los componentes, servicios, módulos, capas o elementos de infraestructura
  donde se materializa cada decisión, haciendo referencia a las vistas Lógica, de Procesos,
  Física y Funcional.

Este proceso garantiza que la arquitectura responde de manera directa, verificable y completa
a los requisitos críticos del sistema.

=== Cómo Interpretar la Matriz

La Matriz de Trazabilidad está organizada en cuatro columnas:

* *Driver (ID y Tipo):*  
  Corresponde al ASR que necesita ser satisfecho. Puede ser un QAS, una restricción, una
  preocupación o un caso de uso clave.

* *Decisión de Diseño (Táctica / Patrón):*  
  Es la decisión arquitectónica que fue tomada para abordar dicho driver. Incluye patrones,
  tácticas o componentes específicos del diseño.

* *Artefactos Afectados (Vistas / Elementos):*  
  Indica dónde se materializa la decisión en la arquitectura: servicios, módulos, capas,
  componentes físicos o procesos operativos.

* *Estado:*  
  En este documento, todas las decisiones arquitectónicas clave se encuentran en estado
  *Accepted*, por lo que cada fila de trazabilidad se marca como *Cumple*.

Esta estructura permite verificar de un vistazo si el diseño cubre correctamente todos los elementos
críticos definidos en la fase de requerimientos arquitectónicos.

=== Resumen Ejecutivo

Los siguientes drivers se consideran críticos para el éxito del Sistema de Gestión Hotelera:

* *Desempeño (QAS-02):*  
  La confirmación de reserva y la consulta de disponibilidad deben mantenerse en límites
  estrictos de latencia bajo cargas de hasta 300 QPS y picos de 10 TPS.

* *Escalabilidad (QAS-04):*  
  El sistema debe absorber picos de tráfico con degradación controlada.

* *Seguridad (QAS-05) y Privacidad (CRN-01):*  
  Requiere uso obligatorio de canales cifrados y protección de datos personales y de pago.

* *Disponibilidad (QAS-06, QAS-07):*  
  El sistema debe recuperarse ante fallos y permitir failover automático.

* *Fiabilidad (QAS-09):*  
  La reserva, el pago y el inventario deben comportarse como un proceso transaccional
  distribuido consistente.

* *Preocupaciones Operacionales (CRN-02, CRN-05):*  
  Evitar dobles pagos y dobles reservas es indispensable para la confianza del cliente.

* *Restricciones Técnicas (CON-03, CON-04):*  
  La solución debe soportar web/móvil y utilizar un RDBMS transaccional como base de datos.

Las decisiones arquitectónicas clave incluyen:

* Patrones: *Saga*, *Repositorio*, *API Gateway*, *Message Broker*, *Balanceo de carga*.
* Tácticas: *Idempotencia*, *Concurrencia*, *Redundancia*, *Cifrado TLS*.
* Estructuras: Servicios *stateless*, modulares y escalables.

Estas decisiones garantizan que la arquitectura sea robusta, confiable, segura y alineada con
los requisitos del negocio hotelero.

=== Matriz de Trazabilidad del Diseño Arquitectónico

[.table]
[cols="2,3,3,1"]
|===
| Driver (ID y Tipo)
| Decisión de Diseño (Táctica / Patrón)
| Artefactos Afectados (Vistas / Elementos)
| Estado

// ---------------- QAS-02 ----------------
| QAS-02 (Desempeño) – Latencia en confirmación de reserva (P95 ≤ 2.5 s)
| xref:dec-8[Message Broker] +
  xref:dec-9[Workers asíncronos] +
  xref:dec-2[Arquitectura en capas]
| Vista de Procesos (flujo de reserva), Paquete *Mensajería*, Workers de confirmación
| Cumple

| QAS-02 (Desempeño) – Consultas P95 ≤ 500 ms a 300 QPS
| xref:dec-17[Flujos sin bloqueo] +
  xref:dec-2[Arquitectura en capas]
| ServicioDeInventario, Vista Lógica, Vista de Procesos
| Cumple

// ---------------- QAS-04 ----------------
| QAS-04 (Escalabilidad) – Manejo de picos de tráfico (10 TPS)
| xref:dec-12[Balanceador de carga] +
  xref:dec-16[Servicios stateless]
| Vista Física (cluster), Nodos Front-End, Servicios distribuidos
| Cumple

// ---------------- QAS-05 / CRN-01 ----------------
| QAS-05 (Seguridad) & CRN-01 (Privacidad de PII)
| xref:dec-4[API Gateway] +
  xref:dec-5[Cifrado TLS]
| Vista Física (API Gateway), Certificados SSL, Capa de borde
| Cumple

// ---------------- QAS-06 ----------------
| QAS-06 (Disponibilidad) – Failover y tolerancia a fallos
| xref:dec-11[Redundancia por clustering] +
  xref:dec-16[Servicios stateless]
| Vista Física (nodos replicados)
| Cumple

// ---------------- QAS-07 / CRN-02 ----------------
| QAS-07 (Disponibilidad) & CRN-02 (Evitar pagos dobles)
| xref:dec-7[Idempotencia en pagos]
| ServicioDePago, Registro de transacciones
| Cumple

// ---------------- QAS-08 / CON-03 ----------------
| QAS-08 (Portabilidad) & CON-03 – Soporte web/móvil
| xref:dec-2[Arquitectura en capas] +
  xref:dec-3[API RESTful]
| Vista Lógica (Presentación, Servicios, Datos)
| Cumple

// ---------------- QAS-09 / CRN-05 ----------------
| QAS-09 (Fiabilidad) – Atomicidad reserva–pago–inventario
| xref:dec-6[Patrón Saga] +
  xref:dec-10[Exclusión mutua en inventario]
| ServicioDeReservas (Orquestador Saga), ServicioDeInventario, ServicioDePagos
| Cumple

// ---------------- CON-04 ----------------
| CON-04 – Uso obligatorio de RDBMS
| xref:dec-1[MySQL] +
  xref:dec-14[Patrón Repositorio]
| Componente Acceso a Datos; Vista Física (DB MySQL)
| Cumple

// ---------------- CRN-05 ----------------
| CRN-05 – Evitar dobles reservas bajo alta concurrencia
| xref:dec-10[Exclusión mutua] +
  xref:dec-6[Saga]
| ServicioDeInventario, Vista de Procesos (reservas simultáneas)
| Cumple

// ---------------- CU-02 ----------------
| CU-02 – Consultar disponibilidad mínima
| xref:dec-17[Optimización de consultas] +
  xref:dec-2[Arquitectura en capas]
| Vista Funcional, Vista Lógica, ServicioDeInventario
| Cumple

// ---------------- Overbooking ----------------
| Política de Overbooking del 10%
| xref:dec-10[Control de concurrencia en inventario]
| ServicioDeInventario (módulo de overbooking)
| Cumple

|===
